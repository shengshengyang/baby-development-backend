<!DOCTYPE html>
<html lang="zh-Hant"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{dashboardLayout}">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<main layout:fragment="content">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-heading font-bold text-gray-800 dark:text-white mb-2">Dashboard</h1>
        <p class="text-gray-500 dark:text-gray-400">Overview of your content and statistics</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Milestone Card -->
        <div class="relative overflow-hidden rounded-2xl shadow-xl card-hoverable">
            <div class="absolute inset-0 bg-gradient-to-br from-pastel-yellow to-yellow-100 opacity-90"></div>
            <div class="relative p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h5 class="text-lg font-heading font-semibold text-gray-700">Milestones</h5>
                        <p class="text-xs text-gray-600 mt-1">Developmental milestones</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-white/60 backdrop-blur-sm flex items-center justify-center shadow-sm">
                        <i class="fas fa-trophy text-2xl text-yellow-600"></i>
                    </div>
                </div>
                <p class="text-4xl font-bold text-gray-800 mb-2" th:text="${milestoneCount} ?: '0'">0</p>
                <div class="flex items-center gap-2 text-sm">
                    <span class="px-2 py-1 bg-green-500/20 text-green-700 rounded-lg font-medium">
                        <i class="fas fa-arrow-up mr-1"></i>Active
                    </span>
                </div>
            </div>
        </div>

        <!-- Flashcard Card -->
        <div class="relative overflow-hidden rounded-2xl shadow-xl card-hoverable">
            <div class="absolute inset-0 bg-gradient-to-br from-pastel-blue to-blue-100 opacity-90"></div>
            <div class="relative p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h5 class="text-lg font-heading font-semibold text-gray-700">Flashcards</h5>
                        <p class="text-xs text-gray-600 mt-1">Learning cards</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-white/60 backdrop-blur-sm flex items-center justify-center shadow-sm">
                        <i class="fas fa-id-card text-2xl text-blue-600"></i>
                    </div>
                </div>
                <p class="text-4xl font-bold text-gray-800 mb-2" th:text="${flashcardCount} ?: '0'">0</p>
                <div class="flex items-center gap-2 text-sm">
                    <span class="px-2 py-1 bg-blue-500/20 text-blue-700 rounded-lg font-medium">
                        <i class="fas fa-layer-group mr-1"></i>Total
                    </span>
                </div>
            </div>
        </div>

        <!-- Article Card -->
        <div class="relative overflow-hidden rounded-2xl shadow-xl card-hoverable">
            <div class="absolute inset-0 bg-gradient-to-br from-pastel-pink to-pink-100 opacity-90"></div>
            <div class="relative p-6">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h5 class="text-lg font-heading font-semibold text-gray-700">Articles</h5>
                        <p class="text-xs text-gray-600 mt-1">Published articles</p>
                    </div>
                    <div class="w-12 h-12 rounded-xl bg-white/60 backdrop-blur-sm flex items-center justify-center shadow-sm">
                        <i class="fas fa-newspaper text-2xl text-pink-600"></i>
                    </div>
                </div>
                <p class="text-4xl font-bold text-gray-800 mb-2" th:text="${articleCount} ?: '0'">0</p>
                <div class="flex items-center gap-2 text-sm">
                    <span class="px-2 py-1 bg-pink-500/20 text-pink-700 rounded-lg font-medium">
                        <i class="fas fa-pencil-alt mr-1"></i>Published
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="glass-panel rounded-2xl shadow-xl p-6">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-heading font-bold text-gray-800 dark:text-white">Content Statistics</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Overview of all content types</p>
            </div>
            <div class="flex gap-2">
                <button onclick="changeChartType('bar')" class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary hover:bg-primary/20 transition-colors text-sm font-medium">
                    <i class="fas fa-chart-bar mr-1"></i>Bar
                </button>
                <button onclick="changeChartType('line')" class="px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <i class="fas fa-chart-line mr-1"></i>Line
                </button>
                <button onclick="changeChartType('doughnut')" class="px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                    <i class="fas fa-chart-pie mr-1"></i>Pie
                </button>
            </div>
        </div>
        <div class="relative" style="height: 350px;">
            <canvas id="dashboardChart"></canvas>
        </div>
    </div>

    <script>
        // Data from Thymeleaf
        const milestoneCount = [[${milestoneCount}]] || 0;
        const flashcardCount = [[${flashcardCount}]] || 0;
        const articleCount = [[${articleCount}]] || 0;

        let chartInstance;
        let currentChartType = 'bar';

        function getChartColors() {
            const isDark = document.documentElement.classList.contains('dark');
            return {
                background: [
                    'rgba(255, 206, 81, 0.8)',
                    'rgba(74, 187, 185, 0.8)',
                    'rgba(255, 143, 119, 0.8)'
                ],
                border: [
                    'rgba(255, 206, 81, 1)',
                    'rgba(74, 187, 185, 1)',
                    'rgba(255, 143, 119, 1)'
                ],
                text: isDark ? '#f3f4f6' : '#1f2937',
                grid: isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
            };
        }

        function renderChart() {
            const ctx = document.getElementById('dashboardChart').getContext('2d');
            const colors = getChartColors();

            if (chartInstance) {
                chartInstance.destroy();
            }

            const chartConfig = {
                type: currentChartType,
                data: {
                    labels: ['Milestones', 'Flashcards', 'Articles'],
                    datasets: [{
                        label: 'Content Count',
                        data: [milestoneCount, flashcardCount, articleCount],
                        backgroundColor: colors.background,
                        borderColor: colors.border,
                        borderWidth: 2,
                        borderRadius: 8,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: currentChartType === 'doughnut',
                            position: 'bottom',
                            labels: {
                                color: colors.text,
                                font: {
                                    family: "'Plus Jakarta Sans', sans-serif",
                                    size: 12
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                family: "'Outfit', sans-serif",
                                size: 14
                            },
                            bodyFont: {
                                family: "'Plus Jakarta Sans', sans-serif",
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 8
                        }
                    },
                    scales: currentChartType !== 'doughnut' ? {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: colors.text,
                                font: {
                                    family: "'Plus Jakarta Sans', sans-serif"
                                },
                                precision: 0
                            },
                            grid: {
                                color: colors.grid
                            }
                        },
                        x: {
                            ticks: {
                                color: colors.text,
                                font: {
                                    family: "'Plus Jakarta Sans', sans-serif"
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    } : {}
                }
            };

            chartInstance = new Chart(ctx, chartConfig);
        }

        function changeChartType(type) {
            currentChartType = type;
            renderChart();
        }

        // Initial render
        renderChart();

        // Watch for theme changes
        const observer = new MutationObserver(() => {
            renderChart();
        });
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class']
        });
    </script>
</main>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{dashboardLayout}">
<head>
    <meta charset="UTF-8">
    <title>搜尋 Milestone</title>
</head>
<body>
<section layout:fragment="content">
    <div class="max-w-6xl mx-auto py-8">
        <h1 class="text-3xl font-bold mb-6 text-primary">搜尋 Milestone</h1>

        <!-- 返回按鈕 -->
        <div class="mb-6">
            <a href="/milestones"
               class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-opacity-90 inline-flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                返回列表
            </a>
        </div>

        <!-- 搜尋表單 -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-lg font-semibold mb-6">搜尋條件</h2>

            <form method="get" action="/milestones/search">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- 年齡選擇 -->
                    <div>
                        <label for="ageId" class="block text-sm font-medium text-gray-700 mb-2">依年齡搜尋</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                                id="ageId" name="ageId">
                            <option value="">請選擇年齡</option>
                            <option th:each="age : ${ages}"
                                    th:value="${age.id}"
                                    th:text="${age.displayName != null ? age.displayName.getLangByLocaleName() : age.month + ' 個月'}"
                                    th:selected="${searchAgeId != null and searchAgeId == age.id}">
                            </option>
                        </select>
                    </div>

                    <!-- 月份輸入 -->
                    <div>
                        <label for="ageMonth" class="block text-sm font-medium text-gray-700 mb-2">或依月份搜尋</label>
                        <input type="number"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                               id="ageMonth" name="ageMonth"
                               th:value="${searchAgeMonth}" min="0" max="120"
                               placeholder="輸入月數 (0-120)">
                    </div>

                    <!-- 操作按鈕 -->
                    <div class="flex items-end space-x-3">
                        <button type="submit"
                                class="flex-1 px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90 transition-colors">
                            搜尋
                        </button>
                        <a href="/milestones/search"
                           class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">
                            清除
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- 搜尋結果 -->
        <div th:if="${milestones != null}">
            <!-- 結果標題 -->
            <div class="mb-6">
                <h2 class="text-xl font-semibold">搜尋結果
                    <span class="text-primary" th:text="'(' + ${milestones.size()} + ' 筆)'"></span>
                </h2>
            </div>

            <!-- 搜尋結果表格 -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <!-- 如果沒有搜尋結果 -->
                <div th:if="${#lists.isEmpty(milestones)}" class="text-center py-8">
                    <div class="text-gray-500 mb-4">
                        <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <p class="text-lg text-gray-600 mb-4">找不到符合條件的 Milestone</p>
                    <a href="/milestones" class="bg-primary text-white px-6 py-2 rounded hover:bg-opacity-90">
                        瀏覽所有 Milestone
                    </a>
                </div>

                <!-- 資料表格 -->
                <div th:if="${!#lists.isEmpty(milestones)}" class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                        <tr class="text-left border-b bg-gray-50">
                            <th class="py-3 px-4 font-semibold">圖片</th>
                            <th class="py-3 px-4 font-semibold">年齡</th>
                            <th class="py-3 px-4 font-semibold">類別</th>
                            <th class="py-3 px-4 font-semibold">描述</th>
                            <th class="py-3 px-4 font-semibold">影片</th>
                            <th class="py-3 px-4 font-semibold">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="milestone : ${milestones}" class="border-b hover:bg-gray-50">
                            <!-- 圖片 -->
                            <td class="py-3 px-4">
                                <div th:if="${milestone.imageBase64 != null}" class="flex-shrink-0">
                                    <img th:src="${milestone.imageBase64}"
                                         alt="里程碑圖片"
                                         class="w-12 h-12 rounded-lg object-cover shadow-sm">
                                </div>
                                <div th:unless="${milestone.imageBase64 != null}"
                                     class="w-12 h-12 bg-gray-200 rounded border flex items-center justify-center">
                                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                            </td>

                            <!-- 年齡 -->
                            <td class="py-3 px-4">
                                <span th:if="${milestone.age != null and milestone.age.displayName != null}"
                                      th:text="${milestone.age.displayName}"
                                      class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                </span>
                                <span th:if="${milestone.age == null or milestone.age.displayName == null}"
                                      class="text-gray-500">未設定</span>
                            </td>

                            <!-- 類別 -->
                            <td class="py-3 px-4">
                                <span th:if="${milestone.category != null and milestone.category.name != null}"
                                      th:text="${milestone.category.name}"
                                      class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                                </span>
                                <span th:if="${milestone.category == null or milestone.category.name == null}"
                                      class="text-gray-500">未分類</span>
                            </td>

                            <!-- 描述 -->
                            <td class="py-3 px-4">
                                <div class="max-w-xs">
                                    <span th:if="${milestone.description != null}"
                                          th:text="${#strings.abbreviate(milestone.description, 50)}"
                                          th:title="${milestone.description}"
                                          class="truncate block">
                                    </span>
                                    <span th:if="${milestone.description == null}"
                                          class="text-gray-500">無內容</span>
                                </div>
                            </td>

                            <!-- 影片 -->
                            <td class="py-3 px-4">
                                <div th:if="${milestone.videoUrl != null and !#strings.isEmpty(milestone.videoUrl)}">
                                    <a th:href="${milestone.videoUrl}" target="_blank"
                                       class="inline-flex items-center px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm hover:bg-red-200 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                                        </svg>
                                        影片
                                    </a>
                                </div>
                                <div th:unless="${milestone.videoUrl != null and !#strings.isEmpty(milestone.videoUrl)}"
                                     class="text-gray-500 text-center">—</div>
                            </td>

                            <!-- 操作 -->
                            <td class="py-3 px-4">
                                <div class="flex space-x-2">
                                    <a th:href="@{'/milestones/view/' + ${milestone.id}}"
                                       class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded hover:bg-green-200 transition-colors text-sm">
                                        檢視
                                    </a>
                                    <a th:href="@{'/milestones/edit/' + ${milestone.id}}"
                                       class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition-colors text-sm">
                                        編輯
                                    </a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 搜尋提示 -->
                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="text-blue-800">
                        <p class="font-medium mb-1">搜尋提示</p>
                        <ul class="text-sm space-y-1 list-disc list-inside">
                            <li>可以按年齡範圍或特定月份搜尋里程碑</li>
                            <li>年齡搜尋會顯示該年齡段的所有里程碑</li>
                            <li>月份搜尋會精確匹配指定月份的里程碑</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>
